#!/bin/bash -e
# shellcheck source=lib/all.bash
. "${taito_plugin_path:?}/lib/all.bash"

# Misc modules
misc_modules=$(
  ls -d scripts/terraform/* | \
    grep "scripts/terraform/misc-" | \
    sed 's|scripts/terraform/||'
)
for misc in ${misc_modules}; do
  terraform::run apply "${misc}" "${taito_env:?}"
done

# Targets (databases, etc)
for target in ${taito_targets:-}; do
  terraform::run apply "${target}" "${taito_env}" "${target}/terraform"
done

# Uptime provider
[[ ${taito_uptime_provider:-} ]] && \
  terraform::run apply "${taito_uptime_provider}-uptime" "${taito_env}"

taito::call_next "${@}"
