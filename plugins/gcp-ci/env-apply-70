#!/bin/bash -e
: "${taito_zone:?}"
: "${taito_vc_repository:?}"
: "${taito_project:?}"

taito::confirm "Add a build trigger for ${taito_project} in ${taito_zone}" || \
  taito::skip_to_next "${@}"

echo "Create a new build trigger with these settings if one does not exist already:"
echo "- Source: ${taito_vc_provider:-GitHub}"
echo "- Repository: ${taito_vc_repository}"
echo "- Name: ${taito_project}"
echo "- Description: ${taito_project}"
echo "- Trigger type: Branch"
echo "- Branch (regex) - Most likely one of these depending on zone:"
echo "    ^(dev|test)\$"
echo "    ^(stag|canary|master)\$"
echo "- Build configuration: Cloud Build configuration file (yaml or json)"
echo "- Cloud Build configuration file location: /cloudbuild.yaml"
echo
echo "Press enter to open build trigger management"
read -r

opts=""
if [[ ${google_authuser:-} ]]; then
  opts="authuser=${google_authuser}&"
fi

taito::open_browser \
  "https://console.cloud.google.com/cloud-build/triggers?${opts}project=${taito_zone}"

echo "Press enter when ready"
read -r

taito::call_next "${@}"
