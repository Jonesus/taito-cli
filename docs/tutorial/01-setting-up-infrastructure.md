## 1. Setting up infrastructure

### 1.1. Install or upgrade taito-cli

See the [installation instructions](https://github.com/TaitoUnited/taito-cli/blob/dev/docs/manual/02-installation.md) of the taito-cli manual. If you have already installed taito-cli, you can upgrade it with `taito --upgrade`.

### 1.2. Set up cloud environment, Kubernetes, database cluster and CI/CD pipeline

Taito-cli is designed to be infrastructure agnostic. That is, the same taito-cli commands can be used in any project no matter the technology or infrastructure. These exercises, however, are based on a project template that requires Kubernetes, PostgreSQL, S3 compatible storage bucket and a CI/CD pipeline that is supported by one of the taito-cli plugins. If you don't have an existing infrastructure that provides these already, you can easily set them up by creating a new **taito zone** based on examples that are located in [taito-cli/examples/zones](https://github.com/TaitoUnited/taito-cli/tree/master/examples).

TODO:
* register a domain name
* Google Cloud account
* auth
* TODO OPTIONAL: first setup remote state for terraform

You can create a taito zone based on the Google Cloud example with the following commands. Replace `EDIT` with your favorite editor.

```shell
cp -r taito-cli/examples/zones/gcloud my-zone
cd my-zone
EDIT taito-config.sh
taito zone apply
```

A **taito zone** provides an infrastructure that your projects are deployed on (for example Kubernetes clusters, database clusters and cloud services). You usually have at least two taito zones: one for development and testing purposes, and an another one for production usage. In these exercises, however, you require only one taito zone.

Do not confuse taito zones with cloud provider regions and zones. Each taito zone may use multiple cloud provider regions and zones to achieve high availability and regional resiliency. Taito zones are created mainly based on maintainability and security concerns instead.

---

TODO USE SOME OF THE OLD TEXT FROM EXAMPLE README.md:

# Quick start

In this example we use Google Cloud.

> NOTE: Taito-cli is still work in progress. Not all steps work yet.

## Initial preparations

1. Create a Google Cloud account.

2. Create a billing account on Google Cloud.

3. Install taito-cli.

## Create a taito zone in Google Cloud

TODO OPTIONAL: first setup remote state for terraform

1. Configure `taito_zone` and `gcloud_org_id` in the `zone-gcloud/taito-config.sh` file. (TODO configure all places that say...) (TODO installing without organization?)

2. Authenticate by running `taito --auth` in the `zone-gcloud` directory.

3. Create taito zone by running `taito zone apply` in the `zone-gcloud` directory.

4. TODO change postgres user password afterwards or provide it with google_sql_user? tfstate contains some generated passwords and certificates that should be protected anyway! --> TODO: Add note that no need to commit if you don't want to manage state with terraform.

TODO: LoadBalancer IP:
- check google load balancer IP and set DNS record: *.mydomain.com
- make IP permanent: VPC Network -> External IP Addresses -> Ephemeral>Static

TODO: CI/CD cannot pull taito-cli image from another zone -> use docker hub in all examples
TODO: Check TODOs of 'zone apply' command implementations.

The newly created zone includes:

* Kubernetes cluster for applications
* Postgres cluster for data
* Storage for serving static resources
* Container registry and builder for CI/CD
* Stackdriver for logging and monitoring
* Google Functions and pubsub for events/notifications

## Create a project and deploy it to the taito zone

1. Create a new project by running `taito project create: kubernetes-template` and follow instructions.

2. Run `taito project apply` in the project directory. TODO sentry

3. Create dev and prod environments for the project by running `taito env apply:dev` and `taito env apply:prod` in the project directory. This will TODO:

4. Start local development by running: `taito install`, `taito start`, `taito init` and `taito open app`.

5. Push a change in the dev branch and it will be deployed on your Kubernetes cluster running on Google Cloud as a development version. You can open it on browser by running `taito open app:dev`.

6. Merge the change in the master branch and it will be deployed on your Kubernetes cluster running on Google Cloud as a production version. You can open it on browser by running `taito open app:prod`.

Hooray! You are now running your app in production with all the bells and whistles like multiple environments, automatic deployments, deployment versioning and reversions, data migrations, autogenerated release notes, autogenerated ssl certificates, secret rotation, error tracking, uptime monitoring, log analytics, backups, autoscaling, and high availability. Nevertheless, almost anyone is able to operate it using the easy-to-use command set provided by the `taito-cli`. You can also easily move it to any cloud service provider, or alternatively host it on your own dedicated servers. And all the same taito-cli commands still work as they should.

> TODO CDN and performance monitoring.

## Running on some other infrastructure

Want to run software on some other infrastructure than Google Cloud and Kubernetes? Please contribute by developing taito-cli plugins for the infrastructure in question.

## Create a custom extension

TODO instructions

## Miscellaneous tips

See taito-cli commands by running `taito -h`.


---

**Next:** [2. Creating a project](02-creating-a-project.md)
